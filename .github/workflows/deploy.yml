      - name: Deploy to CapRover
        env:
          CAPROVER_URL: ${{ secrets.CAPROVER_URL }}   # ex: http://captain.167-71-70-89.nip.io
          CAPROVER_PASSWORD: ${{ secrets.CAPROVER_PASSWORD }}
          APP_NAME: ${{ secrets.APP_NAME }}
          IMAGE: ${{ env.IMAGE }}
        run: |
          set -e

          echo "üîê Autenticando no CapRover em: $CAPROVER_URL"
          # Faz login e grava corpo + status separadamente
          HTTP_CODE=$(curl -sS -o /tmp/login.json -w '%{http_code}' \
            -X POST "$CAPROVER_URL/api/v2/login" \
            -H "Content-Type: application/json" \
            -d "{\"password\":\"$CAPROVER_PASSWORD\"}")

          echo "HTTP(login) = $HTTP_CODE"
          echo "Body(login) ="
          cat /tmp/login.json || true
          echo

          if [ "$HTTP_CODE" != "200" ]; then
            echo "‚ùå Falha ao autenticar no CapRover (HTTP $HTTP_CODE)"; exit 1
          fi

          TOKEN=$(jq -r '.data.token' /tmp/login.json)
          if [ -z "$TOKEN" ] || [ "$TOKEN" = "null" ]; then
            echo "‚ùå Token ausente na resposta de login"; exit 1
          fi

          echo "üöÄ Solicitando deploy da imagem: $IMAGE para app: $APP_NAME"
          HTTP_CODE=$(curl -sS -o /tmp/override.json -w '%{http_code}' \
            -X POST "$CAPROVER_URL/api/v2/apps/appData/override" \
            -H "x-captain-auth: $TOKEN" \
            -H "Content-Type: application/json" \
            -d "{\"appName\":\"$APP_NAME\",\"dockerImageName\":\"$IMAGE\"}")

          echo "HTTP(override) = $HTTP_CODE"
          echo "Body(override) ="
          cat /tmp/override.json || true
          echo

          if [ "$HTTP_CODE" != "200" ]; then
            echo "‚ùå Falha ao solicitar deploy (HTTP $HTTP_CODE)"; exit 1
          fi

          STATUS=$(jq -r '.status // empty' /tmp/override.json)
          if [ "$STATUS" = "error" ]; then
            echo "‚ùå Erro no CapRover:"; cat /tmp/override.json; exit 1
          fi

          echo "‚úÖ Deploy solicitado com sucesso."
